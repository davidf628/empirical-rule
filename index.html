<!DOCTYPE html>
<html lang="en-US">

<head>

    <title>Empirical Rule</title>
    <meta charset="utf-8">

    <!-- JSX Graph -->
    <script type="text/javascript" charset="UTF-8" src="https://cdn.jsdelivr.net/npm/jsxgraph@1.5.0/distrib/jsxgraphcore.js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/jsxgraph@1.5.0/distrib/jsxgraph.css" />

    <!-- MathJS -->
    <!--<script type="text/javascript" charset="UTF-8" src="./node_modules/mathjs/lib/browser/math.js"></script> -->
    <script type="text/javascript" charset="UTF-8"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.5.1/math.min.js"></script>

    <!-- jStat -->
    <script src="https://cdn.jsdelivr.net/npm/jstat@1.9.5/dist/jstat.min.js"></script>

    <!-- Set a browser icon to use -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <!-- -->

</head>

<html>
<h1>The Empirical Rule</h1>

<label for="samplesize">Sample Size:</label>
<input type="text" id="samplesize" name="samplesize" size="5" value="250">&emsp;&emsp;

<label for="minimum">Min Value:</label>
<input type="text" id="minimum" name="minimum" size="5" value="25">&emsp;&emsp;

<label for="maximmum">Max Value:</label>
<input type="text" id="maximum" name="maximum" size="5" value="65">&emsp;&emsp;

<label for="distribution">Distribution:</label>
<select name="distribution" id="distribution">
    <option value="normal_a">Normal - A</option>
    <option value="normal_b">Normal - B</option>
    <option value="normal_c">Normal - C</option>
    <option value="uniform">Uniform</option>
    <option value="skewed_left">Skewed Left</option>
    <option value="skewed_right">Skewed Right</option>
</select>&emsp;&emsp;

<input type="button" value="Create Data Set" onClick="update(true, false)">&emsp;&emsp;

<br /><br />

<label for="xmin">xMin:</label>
<input type="text" id="xmin" name="xmin" size="5" value="35">&emsp;&emsp;

<label for="xmax">xMax:</label>
<input type="text" id="xmax" name="xmax" size="5" value="55">&emsp;&emsp;

<label for="xscl">Scale:</label>
<input type="text" id="xscl" name="xscl" size="5" value="5">&emsp;&emsp;

<label for="highlights">Highlight Values:</label>
<select name="highlights" id="highlights">
    <option value="none">None</option>
    <option value="within1">Within 1 Standard Deviation</option>
    <option value="within2">Within 2 Standard Deviations</option>
    <option value="within3">Within 3 Standard Deviations</option>
    <option value="right1">One Std Dev to Right</option>
    <option value="left1">One Std Dev to Left</option>
    <option value="right1-2">Two Std Dev to Right</option>
    <option value="right2">Only 2nd Std Dev to Right</option>
</select>&emsp;&emsp;

<input type="button" value="Update" onClick="update(false, true)">&emsp;&emsp;

<input type="button" value="Toggle Fullscreen" onClick="fullscreen()">

<br /><br />

<div>
    <div id='jxgbox' class='jxgbox' style='width:900px; height:600px; float: left; resize: both'></div>
    <div id='displayboard' class='jxgbox' style='width: 320px; height: 600px; float: left; resize: both'></div>
    <div id='displayboard2' class='jxgbox' style='width: 1220px; height: 100px; float: left; resize: both'></div>
</div>

<script type="module">

    import { aRange } from './js/arrays.js';
    import { DotPlot } from './js/dotplot.js';
    import { fullscreen } from './js/helpers.js';
    import { randomNormalDataSet, randomNormalData } from './js/random.js';
    import { round, scalemap } from './js/dmath.js';
    import { evalstr } from './js/eval.js';
    import { mean, stdev, max, min } from './js/stats.js';
    import { normalpdf } from './js/distributions.js';
    import { CheckBox } from './js/checkbox.js';

    let board = JXG.JSXGraph.initBoard('jxgbox', {
        boundingbox: [-10, 10, 10, -10],
        showCopyright: false,
        showNavigation: false,
        axis: false,
        keepaspectratio: false,
        zoom: {
            enabled: false,
        },
        pan: {
            enabled: false,
        }
    });

    let displayboard = JXG.JSXGraph.initBoard('displayboard', {
        boundingbox: [0, 10, 10, 0],
        axis: false,
        showNavigation: false,
        showCopyright: false,
        keepaspectratio: false,
        showClearTraces: false,
        zoom: {
            enabled: false
        },
        pan: {
            enabled: false
        }
    });

    let displayboard2 = JXG.JSXGraph.initBoard('displayboard2', {
        boundingbox: [0, 5, 5, 0],
        axis: false,
        showNavigation: false,
        showCopyright: false,
        keepaspectratio: false,
        showClearTraces: false,
        zoom: {
            enabled: false
        },
        pan: {
            enabled: false
        }
    });

    // Bind module functions to the window object
    window.update = update;
    window.fullscreen = fullscreen;

    // Call init to start off in order to have something too look at:
    let n = Number.parseInt(document.getElementById("samplesize").value);
    let minimum = Number.parseInt(document.getElementById("minimum").value);
    let maximum = Number.parseInt(document.getElementById("maximum").value);

    let xmin = Number.parseInt(document.getElementById("xmin").value);
    let xmax = Number.parseInt(document.getElementById("xmax").value);
    let xscl = Number.parseInt(document.getElementById("xscl").value);

    let data = randomNormalData(n, minimum, maximum);
    let highlightCount = 0;
    let highlightPct = 0;

    let bounds = { x: -9, y: 8, width: 18, height: 20 };
    let axis = { min: xmin, max: xmax, scale: xscl };
    let dotplot = new DotPlot(board, bounds, axis, data, { border: false }); 
    
    let meanValue = mean(data);
    let stdevValue = stdev(data);

    let dataX = aRange(minimum, maximum, 0.1);
    let dataY = dataX.map(x => normalpdf(x, meanValue, stdevValue));
    let ymin = min(dataY);
    let ymax = max(dataY);
    dataY = dataY.map(y => scalemap(y, [ymin, ymax], dotplot.getYBounds()));

    dataX = dataX.map((x) => dotplot.scaleX(x));

    let normalCurve = board.create('curve', [dataX, dataY]);

    
    let meanDisplay = displayboard.create('Text', [1, 9.25, 
        () => `&mu; = ${round(mean(data), 2)}`], 
        { fontSize: 24, fixed: true, highlight: false });

    let stdevDisplay = displayboard.create('Text', [5.5, 9.25, 
        () => `&sigma; = ${round(stdev(data), 2)}`], 
        { fontSize: 24, fixed: true, highlight: false });

    let showNormalCurve = new CheckBox(displayboard, 1, 8.25, 
        'Show Normal Curve', false, () => {

        }
    );

    let dataDisplay = displayboard2.create('Text', [0.1, 3,
        () => `Data Set: ${data}`],
        { fontSize: 24, fixed: true, highlight: false }
    );

    let showMeanMarking = new CheckBox(displayboard, 1, 7.5,
        'Display the Mean', false, () => {

        }
    );

    let showStdDevMarkings = new CheckBox(displayboard, 1, 6.75,
        'Display the Standard Deviation Markings', false, () => {

        }
    );

    let countDisplay = displayboard.create('text', [1, 5.5,
        () => `Highlighted: ${highlightCount}`]);

    let pctDisplay = displayboard.create('text', [1, 4.5,
        () => `Highlighted Percent: ${highlightPct}`]);

    //let data = randomNormalDataSet(200, 25, 4);
    //for(let i=0; i<data.length; i++) {
    //  data[i] = round(data[i]);
    //}
    //console.log(round(25.5));

    function update(newData, newAxis) {
        n = Number.parseInt(document.getElementById("samplesize").value);
        minimum = Number.parseInt(document.getElementById("minimum").value);
        maximum = Number.parseInt(document.getElementById("maximum").value);
        xmin = Number.parseInt(document.getElementById("xmin").value);
        xmax = Number.parseInt(document.getElementById("xmax").value);
        xscl = Number.parseInt(document.getElementById("xscl").value);

        if (newData) {
            data = randomNormalData(n, minimum, maximum);
        }

        if (newAxis) {
            axis = { min: xmin, max: xmax, scale: xscl };
        }
        
        dotplot.updatePlot(data, axis);
        displayboard.update();

    }

</script>


</html>